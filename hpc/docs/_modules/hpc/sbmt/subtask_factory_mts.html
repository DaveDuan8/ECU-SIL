
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=cp1252" />
    <title>hpc.sbmt.subtask_factory_mts</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="index" title="Index" href="../../../genindex.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HPC 2.12.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for hpc.sbmt.subtask_factory_mts</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">subtask_factory_mts.py</span>
<span class="sd">----------------------</span>

<span class="sd">SubTaskFactoryMTS Module for hpc.</span>

<span class="sd">**User-API Interfaces**</span>

<span class="sd">    - `hpc` (complete package)</span>
<span class="sd">    - `SubTaskFactoryMTS` (this module)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=E1103,W0212</span>
<span class="c1"># - import Python modules ----------------------------------------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">makedirs</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">unlink</span><span class="p">,</span> <span class="n">chmod</span><span class="p">,</span> <span class="n">walk</span><span class="p">,</span> <span class="n">rename</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">relpath</span>
<span class="kn">from</span> <span class="nn">stat</span> <span class="kn">import</span> <span class="n">S_IWRITE</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">ignore_patterns</span><span class="p">,</span> <span class="n">rmtree</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">NamedTemporaryFile</span><span class="p">,</span> <span class="n">mkdtemp</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">sub</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span><span class="p">,</span> <span class="n">ParsingError</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha1</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span><span class="p">,</span> <span class="n">ZIP_DEFLATED</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">iteritems</span>

<span class="c1"># - import HPC modules -------------------------------------------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">..bpl</span> <span class="kn">import</span> <span class="n">Bpl</span><span class="p">,</span> <span class="n">BplListEntry</span>
<span class="kn">from</span> <span class="nn">..core.error</span> <span class="kn">import</span> <span class="n">HpcError</span>
<span class="kn">from</span> <span class="nn">..core.tds</span> <span class="kn">import</span> <span class="n">replace_server_path</span><span class="p">,</span> <span class="n">DATA_PATH</span><span class="p">,</span> <span class="n">LOC_HEAD_MAP</span>
<span class="kn">from</span> <span class="nn">..core.convert</span> <span class="kn">import</span> <span class="n">arg_trans</span>
<span class="kn">from</span> <span class="nn">..core.path</span> <span class="kn">import</span> <span class="n">merge_path</span>
<span class="kn">from</span> <span class="nn">..core.robocopy</span> <span class="kn">import</span> <span class="n">Robocopy</span>
<span class="kn">from</span> <span class="nn">..core.artifact</span> <span class="kn">import</span> <span class="n">articopy</span>
<span class="kn">from</span> <span class="nn">..core.logger</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">..mts.mts_check</span> <span class="kn">import</span> <span class="n">debug_lib_check</span><span class="p">,</span> <span class="n">check_mts_ini</span>
<span class="kn">from</span> <span class="nn">..rdb.catalog</span> <span class="kn">import</span> <span class="n">Collection</span>
<span class="kn">from</span> <span class="nn">.subtask_factory</span> <span class="kn">import</span> <span class="n">SubTaskFactory</span>

<span class="c1"># - defines ------------------------------------------------------------------------------------------------------------</span>
<span class="n">ACTIVE_ALGOS</span> <span class="o">=</span> <span class="s1">&#39;active_algos&#39;</span>
<span class="n">INACTIVE_ALGOS</span> <span class="o">=</span> <span class="s1">&#39;inactive_algos&#39;</span>
<span class="n">EXPORTERS</span> <span class="o">=</span> <span class="s1">&#39;exporters&#39;</span>
<span class="n">URL_CNT</span> <span class="o">=</span> <span class="s1">&#39;signal_url_count&#39;</span>
<span class="n">WILD_URL_CNT</span> <span class="o">=</span> <span class="s1">&#39;wildcard_url_count&#39;</span>
<span class="n">CHANNEL_SRC</span> <span class="o">=</span> <span class="s1">&#39;channel_sources&#39;</span>
<span class="n">CHANNEL_TYP</span> <span class="o">=</span> <span class="s1">&#39;channel_types&#39;</span>

<span class="n">XCHANGES</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;SynchroCycle&quot;</span><span class="p">,</span> <span class="s2">&quot;Fast cycle&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Play Speed&quot;</span><span class="p">,</span> <span class="s2">&quot;MAX&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;ReadErrorAction&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]]</span>
<span class="n">BPLMODE</span> <span class="o">=</span> <span class="s2">&quot;BatchPlayerMode&quot;</span>
<span class="n">GDVPLUS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdvplus.dll&#39;</span><span class="p">,</span> <span class="s1">&#39;gdvplus.pdb&#39;</span><span class="p">]</span>


<span class="c1"># - classes ------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MTSCmdHelper"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper">[docs]</a><span class="k">class</span> <span class="nc">MTSCmdHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># pylint: disable=R0902</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command Helper class which handles all MTS specific</span>
<span class="sd">    commands for the TaskFactoryMTS.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MTSCmdHelper.__init__"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;MTS&quot;</span><span class="p">,</span> <span class="n">exist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;init the helper&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exists</span> <span class="o">=</span> <span class="n">exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;%DataFolder%&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\\</span><span class="s1">%JobName%</span><span class="se">\\</span><span class="s1">2_Output</span><span class="se">\\</span><span class="s1">%TaskName%</span><span class="se">\\</span><span class="s1">data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">),</span>
                              <span class="s1">&#39;</span><span class="si">%Lo</span><span class="s1">gFolder%&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\\</span><span class="s1">%JobName%</span><span class="se">\\</span><span class="s1">2_Output</span><span class="se">\\</span><span class="s1">%TaskName%</span><span class="se">\\</span><span class="s1">log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xparam</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xparam&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;playexit&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xparam</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-pal&#39;</span><span class="p">,</span> <span class="s1">&#39;-eab&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;%MeasAppPath%&#39;</span><span class="p">:</span>
                                           <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\\</span><span class="s1">%JobName%</span><span class="se">\\</span><span class="s1">1_Input</span><span class="se">\\</span><span class="s1">%SubPath%</span><span class="se">\\</span><span class="s1">measapp.exe&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">),</span>
                                       <span class="s1">&#39;%SubPath%&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subpath&quot;</span><span class="p">,</span> <span class="s2">&quot;mts_system&quot;</span><span class="p">)})</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;SIL&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;%SilLiteAppPath%&#39;</span><span class="p">:</span>
                                           <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\\</span><span class="s1">%JobName%</span><span class="se">\\</span><span class="s1">1_Input</span><span class="se">\\</span><span class="s1">%SubPath%</span><span class="se">\\</span><span class="s1">sil_lite.exe&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">),</span>
                                       <span class="s1">&#39;%SubPath%&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subpath&quot;</span><span class="p">,</span> <span class="s2">&quot;sil_lite&quot;</span><span class="p">)})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;other than &#39;MTS&#39; or &#39;SIM&#39; type is not allowed!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MTSCmdHelper.get_property"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.get_property">[docs]</a>    <span class="k">def</span> <span class="nf">get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get a property&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s2">&quot;%</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span></div>

<div class="viewcode-block" id="MTSCmdHelper.set_property"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.set_property">[docs]</a>    <span class="k">def</span> <span class="nf">set_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set a key replacement to a certain value</span>

<span class="sd">        :param obj key: name of key</span>
<span class="sd">        :param obj value: value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%</span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MTSCmdHelper.set_app_path"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.set_app_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_app_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set the path of the mts / sil_lite application, which is used</span>
<span class="sd">        by hpc to do the calling. Path of executable.</span>

<span class="sd">        Following Variables will be resolved automatically:</span>

<span class="sd">            - %JobName%</span>
<span class="sd">            - %TaskName%</span>

<span class="sd">        :param str app_path: absolute path to measapp.exe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">app_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">app_path</span> <span class="o">=</span> <span class="s2">&quot;D:</span><span class="se">\\</span><span class="s2">data</span><span class="se">\\</span><span class="s2">%JobName%</span><span class="se">\\</span><span class="s2">1_Input</span><span class="se">\\</span><span class="s2">%SubPath%</span><span class="se">\\</span><span class="s2">measapp.exe&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%MeasAppPath%&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span> <span class="k">else</span> <span class="s2">&quot;%SilLiteAppPath%&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_path</span></div>

<div class="viewcode-block" id="MTSCmdHelper.set_rec_file_path"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.set_rec_file_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_rec_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recfile_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the rec file path parameter for mts.</span>

<span class="sd">        :param str recfile_path: absolute path to the recfile.</span>
<span class="sd">        :raises hpc.HpcError: recfile cannot be set when on SIM mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s2">&quot;sim&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;not allowed to set rec file path!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_file_path</span><span class="p">(</span><span class="n">recfile_path</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MTSCmdHelper.set_sim_file_path"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.set_sim_file_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_sim_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simfile_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the sim file path parameter for SIL lite.</span>

<span class="sd">        :param str simfile_path: absolute path to the recfile.</span>
<span class="sd">        :raises hpc.HpcError: recfile cannot be set when on SIM mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s2">&quot;rec&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;not allowed to set sim file path!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_file_path</span><span class="p">(</span><span class="n">simfile_path</span><span class="p">,</span> <span class="s1">&#39;sim&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set path of file and mode&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exists</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(MEASID) FROM DMT_FILES WHERE LOWER(FILEPATH) LIKE :path &quot;</span>
                            <span class="s2">&quot;AND STATUS = &#39;transmitted&#39;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t exist!&quot;</span> <span class="o">%</span> <span class="n">file_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%</span><span class="si">{}</span><span class="s1">File%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())]</span> <span class="o">=</span> <span class="n">file_path</span>

<div class="viewcode-block" id="MTSCmdHelper.set_bpl_file_path"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.set_bpl_file_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_bpl_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bplfile_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set the bpl file path parameter for MTS / SIL.</span>

<span class="sd">        :param str bplfile_path: absolute path to the recfile, typically a subfolder under %JobName%/1_Input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s1">&#39;bpl&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%BatchFile%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bplfile_path</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cfg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: full path to config file</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgPath&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="MTSCmdHelper.get_cmd_list"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.get_cmd_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_cmd_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_asis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0613</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        prepare the whole cmd_list, either for \*.bpl or \*.rec usage.</span>
<span class="sd">        Replace all internal used placeholder with the data given by the user,</span>
<span class="sd">        and provide it to the user.</span>

<span class="sd">        :param bool cmd_asis: compatibility parameter for CmdHelper class (as of broken Popen), not used here</span>
<span class="sd">        :return: command line as list</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :raises hpc.HpcError: once, path is not specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s1">&#39;rec&#39;</span><span class="p">:</span>
                <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;%MeasAppPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-norestart&#39;</span><span class="p">,</span> <span class="s1">&#39;-silent&#39;</span><span class="p">,</span> <span class="s1">&#39;-pc%CfgPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-lc%CfgName%&#39;</span><span class="p">,</span> <span class="s1">&#39;-lr%RecFile%&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s1">&#39;bpl&#39;</span><span class="p">:</span>
                <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;%MeasAppPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-norestart&#39;</span><span class="p">,</span> <span class="s1">&#39;-silent&#39;</span><span class="p">,</span> <span class="s1">&#39;-pc%CfgPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-lc%CfgName%&#39;</span><span class="p">,</span> <span class="s1">&#39;-lb%BatchFile%&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;file path not specified, set it first!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s1">&#39;sim&#39;</span><span class="p">:</span>
                <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;%SilLiteAppPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-pc%CfgPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-cfg%CfgPath%&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;%CfgName%&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;-meas_pathd:</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">%JobName%</span><span class="se">\\</span><span class="s1">1_Input</span><span class="se">\\</span><span class="s1">mts_measurement&#39;</span><span class="p">,</span> <span class="s1">&#39;-lr%SimFile%&#39;</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s1">&#39;bpl&#39;</span><span class="p">:</span>
                <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;%SilLiteAppPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-silent&#39;</span><span class="p">,</span> <span class="s1">&#39;-cfg%CfgPath%</span><span class="se">\\</span><span class="s1">%CfgName%&#39;</span><span class="p">,</span> <span class="s1">&#39;-pc%CfgPath%&#39;</span><span class="p">,</span> <span class="s1">&#39;-lb%BatchFile%&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;file path not specified, set it first!&quot;</span><span class="p">)</span>

        <span class="n">cmd_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-pd&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%DataFolder%&#39;</span><span class="p">],</span> <span class="s1">&#39;-pl&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%Lo</span><span class="s1">gFolder%&#39;</span><span class="p">]])</span>
        <span class="n">cmd_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xparam</span><span class="p">)</span>
        <span class="n">cmd_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">cmd_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cmd_list</span></div>

<div class="viewcode-block" id="MTSCmdHelper.get_cmd_var_list"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.MTSCmdHelper.get_cmd_var_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_cmd_var_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the whole cmd_var_list, which is a dictionary.</span>

<span class="sd">        :return: cmd_var_list</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: actual command</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cmd_list</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: working directory</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">[</span><span class="s1">&#39;%MeasAppPath%&#39;</span>
                                                         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span> <span class="k">else</span> <span class="s2">&quot;%SilLiteAppPath%&quot;</span><span class="p">]])[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;replace with real values&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cmd_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;%&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmd_var_list</span><span class="p">):</span>
                    <span class="n">cmd_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="s2">&quot;(?i)&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">,</span> <span class="n">repl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">cmd_list</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">cmd_list</span></div>


<div class="viewcode-block" id="SubTaskFactoryMTS"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS">[docs]</a><span class="k">class</span> <span class="nc">SubTaskFactoryMTS</span><span class="p">(</span><span class="n">SubTaskFactory</span><span class="p">):</span>  <span class="c1"># pylint: disable=R0902</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. inheritance-diagram:: hpc.SubTaskFactoryMTS</span>

<span class="sd">    Specialized class for creating Hpc SubTasks which run out MTS.</span>

<span class="sd">    - Typical usage is first to set all information,</span>
<span class="sd">      which is the same for all Tasks. (SetConfigFolder,SetConfigFile,...)</span>
<span class="sd">    - After that, multiple calls of the &quot;create_task&quot;</span>
<span class="sd">      -&gt; for the real MTS-Task creation.</span>
<span class="sd">    - This class is derived from the `SubTaskFactory`,</span>
<span class="sd">      this means all methods from there can also be used.</span>
<span class="sd">    - a private check method is registered to be executed in Job.submit() checking</span>
<span class="sd">      the availability of the MTS config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SubTaskFactoryMTS.__init__"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hpc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param hpc.Job hpc: hpc job class</span>
<span class="sd">        :param dict kwargs: see below</span>

<span class="sd">        :keyword \**kwargs:</span>
<span class="sd">            * *io_watch* (``bool``): whether watchdog shall watch io traffic</span>
<span class="sd">            * *cpu_watch* (``bool``): whether watchdog shall track cpu usage</span>
<span class="sd">            * *time_watch* (``float``): whether watchdog shall monitor time [h]</span>
<span class="sd">            * *prn_watch* (``bool``): whether watchdog shall watch the printout</span>
<span class="sd">            * *time_factor* (``float``): default 16 x recording length</span>
<span class="sd">            * *loglevel* (``int``): use a certain logging level (mts_check)</span>
<span class="sd">            * *exist* (``bool``): check existence of recording, default: False</span>
<span class="sd">            * *mtscheck* (``bool``): check MTS log files for problems, default: False</span>
<span class="sd">            * *skipon* (``list``): continue on certain exitcodes of previous subtask, e.g. [-302, -402]</span>
<span class="sd">            * *cfg_blacklist* (``list[str]``): blacklisted MTS / SilLite config sections</span>
<span class="sd">            * *wrapexe* (``str``): executable wrapped around each sub task</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;MTS&quot;</span><span class="p">)</span>
        <span class="n">SubTaskFactory</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hpc</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_checker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mtscheck&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_blacklist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfg_blacklist&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;EMGenericBv&quot;</span><span class="p">,</span> <span class="s2">&quot;EMObjectList&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fake_copy</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">makedirs</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="s1">&#39;bpl&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span> <span class="o">=</span> <span class="n">MTSCmdHelper</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">,</span>
                                        <span class="n">exist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">base_db</span> <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;exist&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rec_mapping</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;map_rec&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_mts_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg_path</span><span class="p">,</span> <span class="n">cfg_name</span><span class="p">,</span> <span class="n">prev</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=R0912,R0915,R1260</span>
        <span class="sd">&quot;&quot;&quot;check MTS config file&quot;&quot;&quot;</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">allow_no_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,))</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">currcfg</span> <span class="o">=</span> <span class="n">merge_path</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">cfg_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fake_copy</span> <span class="ow">and</span> <span class="s2">&quot;$&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">currcfg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">currcfg</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;config file </span><span class="si">{}</span><span class="s2"> does not exist!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currcfg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">currcfg</span><span class="p">,</span> <span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;ChannelSources&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;ChannelSources&#39;</span><span class="p">,</span> <span class="n">CHANNEL_SRC</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;ChannelTypes&#39;</span><span class="p">,</span> <span class="n">CHANNEL_TYP</span><span class="p">,)):</span>
                    <span class="n">ci</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\\</span><span class="s1">,&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ci</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span> <span class="k">if</span> <span class="n">_f</span><span class="p">]))</span>

            <span class="k">if</span> <span class="s1">&#39;Exporter&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">URL_CNT</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;Signal URL Count&#39;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">WILD_URL_CNT</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;Wildcard URL Count&#39;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">EXPORTERS</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;Is Exporting&#39;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&#39;Is Exporting&#39; option not set, you might get no output!&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;SIM VFB&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SWC Plugin Folder&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SWC Plugin&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_mts_cfg</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span>
                                        <span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SWC Plugin Folder&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &quot;.</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span>
                                             <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SWC Plugin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &quot;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">),</span>
                                        <span class="n">section</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="s2">&quot;MTS Player V2&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">BPLMODE</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_playsections</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">BPLMODE</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;LoggingServerAddress&quot;</span><span class="p">):</span>
                    <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;LoggingServerAddress&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">XCHANGES</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; option not set to </span><span class="si">%s</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                        <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                        <span class="n">rewrite</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SimCfgFile&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">ACTIVE_ALGOS</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SimCfgFile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_meas&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">ACTIVE_ALGOS</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_mts_cfg</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;SimCfgFile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$UserPathCfg$</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                                            <span class="n">section</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">INACTIVE_ALGOS</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">INACTIVE_ALGOS</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;PluginFile&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">section</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">prev</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;PluginFile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">ACTIVE_ALGOS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">ACTIVE_ALGOS</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">INACTIVE_ALGOS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">INACTIVE_ALGOS</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_SRC</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_SRC</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_TYP</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_TYP</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>
            <span class="n">chmod</span><span class="p">(</span><span class="n">currcfg</span><span class="p">,</span> <span class="n">S_IWRITE</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">currcfg</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfp</span><span class="p">:</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cfp</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;manipulated: &quot;</span> <span class="o">+</span> <span class="n">currcfg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cfg</span>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_app_path"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_app_path">[docs]</a>    <span class="k">def</span> <span class="nf">set_app_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide the possibility to set the path to MTS / sil_lite</span>
<span class="sd">        to the correct one, if the default path can&#39;t be used.</span>

<span class="sd">        :note: %JobName% will be replaced with the real JobName.</span>

<span class="sd">        :param app_path:   Absolute path to the measapp.exe, which is used to start the Task.</span>
<span class="sd">        :type app_path:    str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_app_path</span><span class="p">(</span><span class="n">app_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_split_section"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_split_section">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;that option is not supported any longer&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_split_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set split_section for section based exports of MTS</span>

<span class="sd">        :param bool value: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_config_folder"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_config_folder">[docs]</a>    <span class="k">def</span> <span class="nf">set_config_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;deprecate !!!&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;CfgPath&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_config_file_name"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_config_file_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_config_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;deprecate !!!&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_config"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_config">[docs]</a>    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the folder, where MTS / sil_lite will find the given config file.</span>
<span class="sd">        This folder will also be used, if you have multiple configuration,</span>
<span class="sd">        which depends via a relative path from each other.</span>
<span class="sd">        So this Folder will also be used as the base config folder to resolve</span>
<span class="sd">        the relative paths to other given config files.</span>

<span class="sd">        Set the config file name, which shall be used.</span>
<span class="sd">        This FileName can also contain a relative path to the config file,</span>
<span class="sd">        if the Base Config Folder feature is needed.</span>
<span class="sd">        Please see also `SubTaskFactoryMTS.SetConfigFolder`</span>

<span class="sd">        :param str folder: path to base config folder</span>
<span class="sd">        :param str file_name: relative path to config file</span>
<span class="sd">        :raises hpc.HpcError: raised when either folder of file is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">file_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;folder or file_name to MTS config is empty!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;CfgPath&#39;</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">client_in_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_data_folder"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_data_folder">[docs]</a>    <span class="k">def</span> <span class="nf">set_data_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set output data folder for MTS to a different than standard:</span>
<span class="sd">        &quot;D:\\data\\%JobName%\\2_Output\\%TaskName%\\data&quot;</span>

<span class="sd">        :param data_folder:   path to the output data folder on the hpc-client.</span>
<span class="sd">        :type data_folder:    str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;DataFolder&#39;</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.set_parameter"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.set_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set an extra parameter&#39;s value&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_task_create_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bpl_rec_file_path</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze a given input file, if we have rec file mode or \*.bpl file mode.</span>
<span class="sd">        When unsupported File format will be found, a exception will be raised.</span>

<span class="sd">        :param str bpl_rec_file_path: Bpl / Rec File URL which must be used for MTS.</span>
<span class="sd">                                      Type depends on initializer mod (&#39;rec&#39;, &#39;bpl&#39;)</span>
<span class="sd">        :return: mode (&#39;rec&#39;|&#39;bpl&#39;)</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises hpc.HpcError: once we have an unsupportd type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">,</span> <span class="n">BplListEntry</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;bpl&#39;</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.rec&quot;</span><span class="p">,</span> <span class="s2">&quot;.rev&quot;</span><span class="p">,</span> <span class="s2">&quot;.rrec&quot;</span><span class="p">,</span> <span class="s2">&quot;.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;.mf4&quot;</span><span class="p">,):</span>
            <span class="k">return</span> <span class="s1">&#39;rec&#39;</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.mron&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;mron&#39;</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.sim&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;sim&#39;</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.bpl&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;bpl&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">base_db</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM COLLECTIONS WHERE NAME = :coll AND (CP_LABEL </span><span class="si">%s</span><span class="s2">)&quot;</span>
                                  <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;IS NULL OR CP_LABEL = &#39;&#39;&quot;</span> <span class="k">if</span> <span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                                     <span class="p">(</span><span class="s2">&quot;= &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">coll</span><span class="o">=</span><span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;coll&#39;</span>
        <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s1">&#39;Unsupported file type: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

<div class="viewcode-block" id="SubTaskFactoryMTS.create_task"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.create_task">[docs]</a>    <span class="k">def</span> <span class="nf">create_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bpl_rec_file_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=R0912,R0915,R1260,W0221</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a single SubTask based on a given \*.bpl file or a given</span>
<span class="sd">        \*.rec file for MTS or a \*.sim file for sil_lite.</span>
<span class="sd">        If checker is enabled, it will automatically create also a checker task.</span>

<span class="sd">        note: for additional parameters, please review `subtask_factory.create_task` as well</span>

<span class="sd">        :param str bpl_rec_file_path: Bpl / Rec / Sim file URL which must be used for MTS / sil_lite.</span>
<span class="sd">                                      Type depends on initializer mod (&#39;rec&#39;, &#39;bpl&#39;)</span>
<span class="sd">        :param dict kwargs: see below</span>
<span class="sd">        :keyword \**kwargs:</span>
<span class="sd">            * *checker* (``bool``): Enables a second SubTask which checks the MTS / sil_lite Output (xlog, crash)</span>
<span class="sd">        :return: created SubTaskList</span>
<span class="sd">        :rtype:  list[int]</span>
<span class="sd">        :raises hpc.HpcError: in case of a unicode encode problem, reading config</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_task_create_mode</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;coll&#39;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;bpl&#39;</span>
            <span class="n">bpl_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">],</span> <span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                            <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.bpl&quot;</span><span class="p">)</span>
            <span class="n">Collection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">base_db</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">bpl_rec_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">export_bpl</span><span class="p">(</span><span class="n">bpl_file</span><span class="p">)</span>
            <span class="n">bpl_rec_file_path</span> <span class="o">=</span> <span class="n">bpl_file</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;rec&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_server_url</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
            <span class="n">bpl_rec_file_path</span> <span class="o">=</span> <span class="n">replace_server_path</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_rec_file_path</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mron&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_rec_file_path</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;sim&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_server_url</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
            <span class="n">bpl_rec_file_path</span> <span class="o">=</span> <span class="n">replace_server_path</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_sim_file_path</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;bpl&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Bpl</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">bplin</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">bplin</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">rfp</span> <span class="ow">in</span> <span class="n">rec</span><span class="o">.</span><span class="n">filepath</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_server_url</span><span class="p">(</span><span class="n">rfp</span><span class="p">)</span>
                <span class="c1"># copy *.bpl to server if not already there</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="s1">&#39;bpl&#39;</span><span class="p">,</span> <span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">bplin</span><span class="o">.</span><span class="n">filepath</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.bpl&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bpl_rec_file_path</span> <span class="o">!=</span> <span class="n">dest</span><span class="p">:</span>
                    <span class="n">bpl_rec_file_path</span> <span class="o">=</span> <span class="n">dest</span>
                    <span class="k">with</span> <span class="n">Bpl</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bplout</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bplin</span><span class="p">:</span>
                            <span class="n">bplout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

            <span class="c1"># modify path to bpl on node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_bpl_file_path</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">,</span> <span class="s2">&quot;%JobName%</span><span class="se">\\</span><span class="s2">1_Input</span><span class="se">\\</span><span class="s2">bpl&quot;</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">bpl_rec_file_path</span><span class="p">)))</span>

        <span class="n">cfg_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">cfg_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">client_in_path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">mts_zips</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">):</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">ACTIVE_ALGOS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">INACTIVE_ALGOS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">EXPORTERS</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">URL_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">WILD_URL_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_SRC</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simcfg</span><span class="p">[</span><span class="n">CHANNEL_TYP</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_mts_cfg</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgPath&#39;</span><span class="p">)</span>
                                                   <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">client_in_path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)),</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;config contains some illegal chars, please check it: </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">ParsingError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;config syntax error: </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>

            <span class="c1"># we have a blacklist, so we need to parse our config file</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_blacklist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">allow_no_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,))</span>
                    <span class="n">cfg</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;config contains some illegal chars, please check it: </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
                <span class="n">cfg_path</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">)</span>

                <span class="c1"># but do we need to rewrite it, did we find blacklisted sections?</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">sections</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cfg_blacklist</span><span class="p">)):</span>
                    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">dirname</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">prefix</span><span class="o">=</span><span class="n">basename</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span>
                                            <span class="n">suffix</span><span class="o">=</span><span class="n">cfg_path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">filep</span><span class="p">:</span>
                        <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filep</span><span class="p">)</span>
                    <span class="n">oname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">,</span> <span class="n">oname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">oname</span><span class="p">),</span> <span class="n">basename</span><span class="p">(</span><span class="n">filep</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;adaptation: &quot;</span> <span class="o">+</span> <span class="n">oname</span><span class="p">)</span>

                <span class="c1"># in case users set&#39;s another config in the middle (loop)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;CfgName&#39;</span><span class="p">)</span>

        <span class="n">kwcopy</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="p">,</span> <span class="n">recording</span><span class="o">=</span><span class="n">bpl_rec_file_path</span><span class="p">,</span> <span class="n">rec_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rec_mapping</span><span class="p">,</span>
                                 <span class="n">local_rec</span><span class="o">=</span><span class="n">kwcopy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;local_rec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_rec</span><span class="p">),</span>
                                 <span class="n">mtscheck</span><span class="o">=</span><span class="n">kwcopy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;checker&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checker</span><span class="p">),</span> <span class="o">**</span><span class="n">kwcopy</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.create_tasks"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.create_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">create_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bpl_file_path</span><span class="p">,</span> <span class="n">checker</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create a multiple SubTask based on a given \*.bpl file</span>
<span class="sd">        If bpl file entry contains a section, then a bpl file based task</span>
<span class="sd">        will be created, and also the needed split new bpl file with this</span>
<span class="sd">        single entry. If bpl file entry is without sections, the task creation</span>
<span class="sd">        will use directly the \*.rec file path as argument.</span>
<span class="sd">        If checker is enabled, it will automatically create also a checker task.</span>

<span class="sd">        Note: for additional parameters, please review `subtask_factory.create_task` as well</span>

<span class="sd">        :param str bpl_file_path: bpl file URL which must be used for MTS / sil_lite.</span>
<span class="sd">        :param bool checker: enables a second SubTask which checks the MTS Output (xlog, crash)</span>
<span class="sd">        :param dict kwargs: see below</span>
<span class="sd">        :return: SubTaskList</span>
<span class="sd">        :rtype: list[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub_tasks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">Bpl</span><span class="p">(</span><span class="n">bpl_file_path</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s2">&quot;VGA_PWR&quot;</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ignore_missing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                 <span class="n">loc</span><span class="o">=</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">LOC_HEAD_MAP</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">head_node</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">bpl</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bpl</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_simple</span><span class="p">:</span>
                    <span class="n">sub_tasks</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">filepath</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">checker</span><span class="o">=</span><span class="n">checker</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">bpl_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">bpl_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="s1">&#39;bpl&#39;</span><span class="p">,</span> <span class="s2">&quot;rec</span><span class="si">{:05d}</span><span class="s2">.bpl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">bpl_cnt</span><span class="p">))</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">bpl_file</span><span class="p">)</span>
                    <span class="n">sub_tasks</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">bpl_file</span><span class="p">)</span>

            <span class="c1"># for bplf, item in BplSplitter(self._hpc, bpl_file_path):</span>
            <span class="c1">#     # Check if entry contains sections</span>
            <span class="c1">#     if bplf:  # use the created bpl file</span>
            <span class="c1">#         sub_tasks += self.create_task(item, checker=checker, **kwargs)</span>
            <span class="c1">#     else:  # just use the rec file</span>
            <span class="c1">#         sub_tasks += self.create_task(str(item), checker=checker, **kwargs)</span>

        <span class="k">return</span> <span class="n">sub_tasks</span></div>

<div class="viewcode-block" id="SubTaskFactoryMTS.copy_mts_folders"><a class="viewcode-back" href="../../../hpc.sbmt.html#hpc.SubTaskFactoryMTS.copy_mts_folders">[docs]</a>    <span class="k">def</span> <span class="nf">copy_mts_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=R0912,R0914,R0915,R1260</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        copy MTS folders from default (or given) directories and</span>
<span class="sd">        omit unneeded mts files and folders that are not needed in offline simulation</span>

<span class="sd">        :param \*args: *mts_sys_folder_name*, *mts_measure_folder_name*, *use_filter*, *mts_sys_dest*</span>
<span class="sd">                       and *mts_measure_dest* can be given, others are optional (kwargs)</span>

<span class="sd">        :keyword \**kwargs:</span>
<span class="sd">            * *mts_sys_folder_name* (``str``): MTS system folder path</span>
<span class="sd">            * *mts_measure_folder_name* (``str``): MTS measurement folder path</span>
<span class="sd">            * *use_filter* (``bool``): deactivate ignore filter, default: True</span>
<span class="sd">            * *mts_sys_dest* (``str``): destination path for mts_system</span>
<span class="sd">            * *mts_measure_dest* (``str``): destination path for mts_measurement</span>
<span class="sd">        :raises hpc.HpcError: on copy error</span>
<span class="sd">        :raises ValueError: in case path cannot be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># mts_sys_folder_name=r&#39;.\mts_system&#39;, mts_measure_folder_name=r&#39;.\mts_measurement&#39;,</span>
        <span class="c1"># use_filter=False, mts_sys_dest=r&#39;mts_system&#39;, mts_measure_dest=r&#39;mts_measurement&#39;</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">arg_trans</span><span class="p">([[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_cmd_var_list</span><span class="p">()[</span><span class="s1">&#39;%SubPath%&#39;</span><span class="p">]],</span>
                          <span class="p">[</span><span class="s1">&#39;mts_measure_folder_name&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;.\mts_measurement&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;use_filter&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;mts_sys_dest&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">get_cmd_var_list</span><span class="p">()[</span><span class="s1">&#39;%SubPath%&#39;</span><span class="p">]],</span>
                          <span class="p">[</span><span class="s1">&#39;mts_measure_dest&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;mts_measurement&#39;</span><span class="p">]],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;debug_run&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;debug_run parameter is deprecated, please don&#39;t use any longer!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cmd_helper</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;SubPath&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="s2">&quot;mts_sys_dest&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fake_copy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fake_copy&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fake_copy</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">tmpdir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">[</span><span class="s2">&quot;mts_sys_folder_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;mts_&#39;</span><span class="p">)</span>
            <span class="n">articopy</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s2">&quot;mts_sys_folder_name&quot;</span><span class="p">],</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;mts_sys_folder_name&quot;</span><span class="p">:</span> <span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;mts_system&quot;</span><span class="p">),</span>
                         <span class="s2">&quot;mts_measure_folder_name&quot;</span><span class="p">:</span> <span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;mts_measurement&quot;</span><span class="p">)})</span>

        <span class="c1"># check for correct mts_system path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;can&#39;t find path &#39;&quot;</span> <span class="o">+</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_folder_name&#39;</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;can&#39;t find path &#39;&quot;</span> <span class="o">+</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_folder_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Check if mts.ini file is correct</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check_mts_ini</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">],</span> <span class="s1">&#39;mts.ini&#39;</span><span class="p">),</span> <span class="n">basename</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_dest&#39;</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;manipulated: &quot;</span> <span class="o">+</span> <span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">],</span> <span class="s1">&#39;mts.ini&#39;</span><span class="p">))</span>
            <span class="n">exe</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">],</span> <span class="s1">&#39;measapp.exe&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exe</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">],</span> <span class="s1">&#39;sil_lite.exe&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfile</span><span class="p">(</span><span class="n">exe</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HpcError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not found in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">exe</span><span class="p">),</span> <span class="n">dirname</span><span class="p">(</span><span class="n">exe</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">debug_lib_check</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;debug DLL found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># short_test = self._hpc.sched.template in (&quot;Short_Test&quot;, &quot;WSN_Test&quot;)</span>
        <span class="c1"># if not short_test and debug_lib_check(opts[&#39;mts_sys_folder_name&#39;]):</span>
        <span class="c1">#     raise HpcError(&quot;Debug dll&#39;s are only allowed in the &#39;Short_Test&#39; template. Found debug dlls: %s&quot;</span>
        <span class="c1">#                    % opts[&#39;mts_sys_folder_name&#39;])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;copying MTS package (</span><span class="si">%s</span><span class="s2">) to job&#39;s path&quot;</span><span class="p">,</span> <span class="n">dirname</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">]))</span>
        <span class="n">mts_filter</span> <span class="o">=</span> <span class="n">GDVPLUS</span>
        <span class="c1"># if not short_test:</span>
        <span class="c1">#     mts_filter.append(&quot;*.pdb&quot;)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;use_filter&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># *.pdb added here instead</span>
            <span class="n">mts_filter</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;doc*&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="s1">&#39;mi4_system_driver&#39;</span><span class="p">,</span> <span class="s1">&#39;MTSV2AppWizard&#39;</span><span class="p">,</span> <span class="s1">&#39;www&#39;</span><span class="p">,</span> <span class="s1">&#39;*.bsig&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;CrashRep_measapp_*.*&#39;</span><span class="p">,</span> <span class="s1">&#39;CrashReport.*&#39;</span><span class="p">,</span> <span class="s1">&#39;errmon_*.*&#39;</span><span class="p">,</span> <span class="s1">&#39;errorlog.*&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pdb&#39;</span><span class="p">])</span>
        <span class="n">mts_filter</span> <span class="o">=</span> <span class="n">ignore_patterns</span><span class="p">(</span><span class="o">*</span><span class="n">mts_filter</span><span class="p">)</span>

        <span class="n">replace</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="s2">&quot;MTS&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">job_sim</span><span class="p">:</span>
                <span class="n">replace</span><span class="p">[</span><span class="s1">&#39;*.par&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;[GenericDrawActive].Value=1&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;[GenericDrawActive].Value=0&#39;</span><span class="p">,)]</span>

        <span class="k">if</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;zip&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">job_sim</span><span class="p">:</span>
            <span class="n">tmpfn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="s2">&quot;mts.zip&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">tmpfn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ZIP_DEFLATED</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">zfp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">]),</span> <span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_folder_name&#39;</span><span class="p">]),):</span>
                    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="c1"># what we need to ignore</span>
                        <span class="n">ignored</span> <span class="o">=</span> <span class="n">mts_filter</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;ignored: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ignored</span><span class="p">])</span>

                        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">-</span> <span class="n">ignored</span><span class="p">:</span>
                            <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                            <span class="n">rel</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                            <span class="n">zfp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
            <span class="n">hsh</span> <span class="o">=</span> <span class="n">sha1</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zfp</span><span class="o">.</span><span class="n">infolist</span><span class="p">():</span>
                <span class="n">hsh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="n">hx</span> <span class="o">=</span> <span class="n">hsh</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">hxfn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="n">hx</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">hxfn</span><span class="p">):</span>
                    <span class="n">rename</span><span class="p">(</span><span class="n">tmpfn</span><span class="p">,</span> <span class="n">hxfn</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">mts_zips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hx</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;zip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">unlink</span><span class="p">(</span><span class="n">tmpfn</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;zip&#39;</span><span class="p">]:</span>
            <span class="n">robo</span> <span class="o">=</span> <span class="n">Robocopy</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ignore</span><span class="o">=</span><span class="n">mts_filter</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span>
                            <span class="n">stat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># copy mts_system and mts_measurement</span>
            <span class="n">robo</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_folder_name&#39;</span><span class="p">]),</span>
                      <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_sys_dest&#39;</span><span class="p">]))</span>
            <span class="n">robo</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_folder_name&#39;</span><span class="p">]),</span>
                      <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">net_in_path</span><span class="p">,</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;mts_measure_dest&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">robo</span><span class="o">.</span><span class="n">changes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tmpdir</span><span class="p">:</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfg_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># let&#39;s remove temp config again...</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cfg_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MTS package copy finished&quot;</span><span class="p">)</span></div></div>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HPC 2.12.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, VDS.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>